{"ast":null,"code":"\"use strict\"; // Copyright 2020 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.IdTokenClient = void 0;\n\nconst oauth2client_1 = require(\"./oauth2client\");\n\nclass IdTokenClient extends oauth2client_1.OAuth2Client {\n  /**\n   * Google ID Token client\n   *\n   * Retrieve access token from the metadata server.\n   * See: https://developers.google.com/compute/docs/authentication\n   */\n  constructor(options) {\n    super();\n    this.targetAudience = options.targetAudience;\n    this.idTokenProvider = options.idTokenProvider;\n  }\n\n  async getRequestMetadataAsync( // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  url) {\n    if (!this.credentials.id_token || (this.credentials.expiry_date || 0) < Date.now()) {\n      const idToken = await this.idTokenProvider.fetchIdToken(this.targetAudience);\n      this.credentials = {\n        id_token: idToken,\n        expiry_date: this.getIdTokenExpiryDate(idToken)\n      };\n    }\n\n    const headers = {\n      Authorization: 'Bearer ' + this.credentials.id_token\n    };\n    return {\n      headers\n    };\n  }\n\n  getIdTokenExpiryDate(idToken) {\n    const payloadB64 = idToken.split('.')[1];\n\n    if (payloadB64) {\n      const payload = JSON.parse(Buffer.from(payloadB64, 'base64').toString('ascii'));\n      return payload.exp * 1000;\n    }\n  }\n\n}\n\nexports.IdTokenClient = IdTokenClient;","map":{"version":3,"names":["Object","defineProperty","exports","value","IdTokenClient","oauth2client_1","require","OAuth2Client","constructor","options","targetAudience","idTokenProvider","getRequestMetadataAsync","url","credentials","id_token","expiry_date","Date","now","idToken","fetchIdToken","getIdTokenExpiryDate","headers","Authorization","payloadB64","split","payload","JSON","parse","Buffer","from","toString","exp"],"sources":["C:/Users/frexm/Desktop/ProductListing/node_modules/google-auth-library/build/src/auth/idtokenclient.js"],"sourcesContent":["\"use strict\";\n// Copyright 2020 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.IdTokenClient = void 0;\nconst oauth2client_1 = require(\"./oauth2client\");\nclass IdTokenClient extends oauth2client_1.OAuth2Client {\n    /**\n     * Google ID Token client\n     *\n     * Retrieve access token from the metadata server.\n     * See: https://developers.google.com/compute/docs/authentication\n     */\n    constructor(options) {\n        super();\n        this.targetAudience = options.targetAudience;\n        this.idTokenProvider = options.idTokenProvider;\n    }\n    async getRequestMetadataAsync(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    url) {\n        if (!this.credentials.id_token ||\n            (this.credentials.expiry_date || 0) < Date.now()) {\n            const idToken = await this.idTokenProvider.fetchIdToken(this.targetAudience);\n            this.credentials = {\n                id_token: idToken,\n                expiry_date: this.getIdTokenExpiryDate(idToken),\n            };\n        }\n        const headers = {\n            Authorization: 'Bearer ' + this.credentials.id_token,\n        };\n        return { headers };\n    }\n    getIdTokenExpiryDate(idToken) {\n        const payloadB64 = idToken.split('.')[1];\n        if (payloadB64) {\n            const payload = JSON.parse(Buffer.from(payloadB64, 'base64').toString('ascii'));\n            return payload.exp * 1000;\n        }\n    }\n}\nexports.IdTokenClient = IdTokenClient;\n//# sourceMappingURL=idtokenclient.js.map"],"mappings":"AAAA,a,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,aAAR,GAAwB,KAAK,CAA7B;;AACA,MAAMC,cAAc,GAAGC,OAAO,CAAC,gBAAD,CAA9B;;AACA,MAAMF,aAAN,SAA4BC,cAAc,CAACE,YAA3C,CAAwD;EACpD;AACJ;AACA;AACA;AACA;AACA;EACIC,WAAW,CAACC,OAAD,EAAU;IACjB;IACA,KAAKC,cAAL,GAAsBD,OAAO,CAACC,cAA9B;IACA,KAAKC,eAAL,GAAuBF,OAAO,CAACE,eAA/B;EACH;;EAC4B,MAAvBC,uBAAuB,EAC7B;EACAC,GAF6B,EAExB;IACD,IAAI,CAAC,KAAKC,WAAL,CAAiBC,QAAlB,IACA,CAAC,KAAKD,WAAL,CAAiBE,WAAjB,IAAgC,CAAjC,IAAsCC,IAAI,CAACC,GAAL,EAD1C,EACsD;MAClD,MAAMC,OAAO,GAAG,MAAM,KAAKR,eAAL,CAAqBS,YAArB,CAAkC,KAAKV,cAAvC,CAAtB;MACA,KAAKI,WAAL,GAAmB;QACfC,QAAQ,EAAEI,OADK;QAEfH,WAAW,EAAE,KAAKK,oBAAL,CAA0BF,OAA1B;MAFE,CAAnB;IAIH;;IACD,MAAMG,OAAO,GAAG;MACZC,aAAa,EAAE,YAAY,KAAKT,WAAL,CAAiBC;IADhC,CAAhB;IAGA,OAAO;MAAEO;IAAF,CAAP;EACH;;EACDD,oBAAoB,CAACF,OAAD,EAAU;IAC1B,MAAMK,UAAU,GAAGL,OAAO,CAACM,KAAR,CAAc,GAAd,EAAmB,CAAnB,CAAnB;;IACA,IAAID,UAAJ,EAAgB;MACZ,MAAME,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWC,MAAM,CAACC,IAAP,CAAYN,UAAZ,EAAwB,QAAxB,EAAkCO,QAAlC,CAA2C,OAA3C,CAAX,CAAhB;MACA,OAAOL,OAAO,CAACM,GAAR,GAAc,IAArB;IACH;EACJ;;AAlCmD;;AAoCxD9B,OAAO,CAACE,aAAR,GAAwBA,aAAxB"},"metadata":{},"sourceType":"script"}